<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>역할관리</title>
  </head>
  <body>
    <!-- Content 시작 -->
    <div layout:fragment="content" class="col">
      <div class="row">
        <div class="col-4">
          <div id="toolbar">
            <button id="btnNewRole" class="btn btn-outline-info">
              <i class="bi bi-file-earmark-plus"></i> 신규
            </button>
          </div>
          <table
            id="table_role"
            data-toolbar="#toolbar"
            data-search="true"
            data-click-to-select="true"
            data-id-field="roleSeq"
            th:data-url="@{/system/role_mgt/role_list.json}">
          </table>
        </div>
        <div class="col-8">
          <div class="row" id="child-box">
            <ul class="nav nav-tabs">
              <li class="nav-item">
                <a class="nav-link" id="tabRoleInfo">역할 상세</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="tabRoleUsers" >역할 사용자</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="tabRoleMenus">역할 메뉴</a>
              </li>
            </ul>
          </div>
          <div class="row border border-top-0 border-secondary-subtle" style="height: 558px;">
            <div id="tabRoleInfoDiv">
              <h4 class="mt-4 mb-3" id="form-title">역할 정보</h4>
              <div class="row g-3">
                <div class="col-sm-6">
                  <label for="roleNm" class="form-label">역할 명</label>
                  <input type="text" class="form-control" id="roleNm">
                  <input type="hidden" id="roleSeq">
                </div>
                <div class="col-sm-6">
                  <label for="roleCd" class="form-label">역할 코드</label>
                  <input type="text" class="form-control" id="roleCd">
                </div>

                <div class="col-12">
                  <label for="defPage" class="form-label">대시 보드</label>
                  <input type="text" class="form-control" id="defPage">
                </div>

                <div class="col-12">
                  <label for="roleDesc" class="form-label">역할 설명</label>
                  <textarea class="form-control" id="roleDesc" rows="3"></textarea>
                </div>
                  </div>
              <div class="row justify-content-between mt-5 pt-5">
                <div class="col-auto me-auto">
                  <button class="w-10 btn btn-danger" type="button" id="btnDeleteRole">
                       <i class="bi bi-trash"></i> 삭제
                     </button>
                </div>
                <div class="col-auto">
                  <button class="w-10 btn btn-primary" type="button" id="btnSaveRole">
                    <i class="bi bi-save"></i> 저장
                  </button>
                </div>
              </div>
            </div>
            <div id="tabRoleUsersDiv">

            </div>
            <div id="tabRoleMenusDiv">

            </div>
          </div>
        </div>
      </div>
    </div>
    <script language="javascript" type="text/javascript" layout:fragment="page_script">
      var $table_role = $('#table_role');

      var fnObj = {
        pageStart:  function(){ // 페이지 초기 실행 스크립트
          fnObj.page.init();
          fnObj.grid.init_role();
          $("#tabRoleInfo").click();
        },
        page: {
          init: function(){ // 버튼 바인딩 등

            $("#tabRoleInfo").bind("click", function(){
              $("#tabRoleInfo").addClass("active");
              $("#tabRoleInfo").prop("aria-current", "page");
              $("#tabRoleInfoDiv").show();

              $("#tabRoleUsers").removeClass("active");
              $("#tabRoleUsers").removeAttr("aria-current");
              $("#tabRoleUsersDiv").hide();

              $("#tabRoleMenus").removeClass("active");
              $("#tabRoleMenus").removeAttr("aria-current");
              $("#tabRoleMenusDiv").hide();
            });

            $("#tabRoleUsers").bind("click", function(){
              $("#tabRoleInfo").removeClass("active");
              $("#tabRoleInfo").removeAttr("aria-current");
              $("#tabRoleInfoDiv").hide();

              $("#tabRoleUsers").addClass("active");
              $("#tabRoleUsers").prop("aria-current", "page");
              $("#tabRoleUsersDiv").show();

              $("#tabRoleMenus").removeClass("active");
              $("#tabRoleMenus").removeAttr("aria-current");
              $("#tabRoleMenusDiv").hide();
            });

            $("#tabRoleMenus").bind("click", function(){
              $("#tabRoleInfo").removeClass("active");
              $("#tabRoleInfo").removeAttr("aria-current");
              $("#tabRoleInfoDiv").hide();

              $("#tabRoleUsers").removeClass("active");
              $("#tabRoleUsers").removeAttr("aria-current");
              $("#tabRoleUsersDiv").hide();

              $("#tabRoleMenus").addClass("active");
              $("#tabRoleMenus").prop("aria-current", "page");
              $("#tabRoleMenusDiv").show();
            });

            $("#btnNewRole").bind("click", function(){
              fnObj.action.initForm();
              $("#form-title").text("신규 역할 정보");
              $("#btnDeleteRole").hide();
            });
          }
        },
        action: { // 호출이나 화면 동작
          initForm: function(){
            $("#form-title").text("");
            $("#roleSeq").val('');
            $("#roleCd").val('');
            $("#roleNm").val('');
            $("#roleDesc").val('');
            $("#defPage").val('');
          },
          setForm: function(cmRole){
                    $("#form-title").text("["+ cmRole.roleNm +"] 역할정보");
            $("#roleSeq").val(cmRole.roleSeq);
            $("#roleCd").val(cmRole.roleCd);
            $("#roleNm").val(cmRole.roleNm);
            $("#roleDesc").val(cmRole.roleDesc);
            $("#defPage").val(cmRole.defPage);
                }
        },
        grid: { // 그리드 관련
          init_role: function() {
            $table_role.bootstrapTable('destroy').bootstrapTable({
              height: 600,
              locale: 'ko-KR',
              classes: 'table table-bordered table-hover',
              headerStyle : function(){
                return {classes: 'table-primary'};
              },
              columns: [

                {field: 'roleSeq',  title: '역할순번',        align: 'center', valign: 'middle', visible: false, switchable: false},
                {field: 'roleCd',   title: '역할코드',        align: 'center', valign: 'middle', sortable: true},
                {field: 'roleNm',   title: '역할명',     align: 'center', valign: 'middle', sortable: true},
                {field: 'defPage',  title: '역할명',     align: 'center', valign: 'middle', visible: false},
              ],
              responseHandler: function (data) { // 데이터 처리
                return data;
              }
            });

            $table_role.on('click-row.bs.table', function (row, rdata, field) {
              $("#table_role tr").removeClass("table-secondary");
              $(field[0]).addClass("table-secondary");
              fnObj.action.initForm();
              fnObj.action.setForm(rdata);
              $("#btnDeleteRole").show();
              $("#tabRoleInfo").click();
            });
          }, // end init_role
          init_reg_user: function(){

          }, // end init_reg_user
          init_tgt_user: function(){

          }, // end init_tgt_user
          init_reg_menu: function(){

          }, // end init_reg_menu
          init_tgt_menu: function(){

          } // init_tgt_menu
        } // end grid
      }
      // 페이지 초기 쿼리를 실행한다.
      $(document.body).ready(function () {
        fnObj.pageStart();
      });
    </script>
  <!-- Content 종료 -->
  </body>
</html>